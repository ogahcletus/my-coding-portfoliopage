"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4593],{61179:function(e,t,r){function n(e,t){var r=t.existing,n=t.getKey,l=new Map,i=!0,a=!1,o=void 0;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;l.set(n(u),u)}}catch(B){a=!0,o=B}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}var d=new Set,p=[],h=!0,f=!1,g=void 0;try{for(var v,m=r[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var Z=n(v.value),b=l.get(Z);b&&(p.push(b),d.add(Z))}}catch(B){f=!0,g=B}finally{try{h||null==m.return||m.return()}finally{if(f)throw g}}var w=!0,x=!1,y=void 0;try{for(var k,R=e[Symbol.iterator]();!(w=(k=R.next()).done);w=!0){var C=k.value;d.has(n(C))||p.push(C)}}catch(B){x=!0,y=B}finally{try{w||null==R.return||R.return()}finally{if(x)throw y}}return p}r.d(t,{Z:function(){return n}})},44593:function(e,t,r){r.d(t,{Z:function(){return Ht}});var n=r(35944),l=r(67294),i=r(69346),a=r(90317),o=r(60731),s=r(77365),c=r(47568),u=r(14924),d=r(26042),p=r(69396),h=r(10253),f=r(34051),g=r.n(f),v=r(88961),m=r(18048),Z=r(38630),b=r(9517),w=r(85485),x=r(29815),y=r(41664),k=r.n(y),R=r(70917),C=r(1144),B=r(93160),S=r(81255),V=r(69928),G=r(4924),T=r(53427),I=r(88046),F=r(27843),E=r(45273),X=(0,i.K)("a"),P=(0,R.iv)({"::after":{content:'""',position:"absolute",top:0,right:0,bottom:0,left:0,display:"block",zIndex:1}});function W(e){var t=e.post,r=t.repl,l=t.user,a=r.isTemplate?"Template":"Repl";return(0,n.BX)(i.Z,{css:S.l0.colWithGap(8),children:[(0,n.BX)(i.Z,{css:[S.l0.flex.row,S.l0.align.center,S.l0.justify.spaceBetween],children:[(0,n.tZ)(i.Z,{css:[S.l0.flex.row,S.l0.align.center],children:(0,n.BX)(i.Z,{css:[S.l0.rowWithGap(8),S.l0.align.center],children:[(0,n.tZ)(E.Z,{size:24,username:l.username,src:l.image}),(0,n.BX)(i.Z,{css:S.l0.rowWithGap(4),children:[(0,n.tZ)(C.x,{children:l.username}),(0,n.BX)(C.x,{color:"dimmest",children:[" published a ",a]})]})]})}),(0,n.tZ)(F.Z,{size:12})]}),(0,n.BX)(B.Z,{css:[S.l0.borderRadius(8),S.l0.colWithGap(8),S.l0.p(8),S.l0.position.relative,{border:"1px solid "+S.TV.outlineDimmest}],children:[(0,n.tZ)(i.Z,{css:[S.l0.colWithGap(16)],children:(0,n.tZ)(i.Z,{css:[S.l0.rowWithGap(16),S.l0.justify.spaceBetween],children:(0,n.BX)(i.Z,{css:[S.l0.rowWithGap(8),S.l0.align.start,S.l0.flex.growAndShrink(1)],children:[(0,n.tZ)(T.ZP,{iconUrl:r.iconUrl,alt:r.title,size:84,css:[S.l0.backgroundColor.backgroundHigher]}),(0,n.BX)(i.Z,{css:[S.l0.flex.growAndShrink(1),S.l0.colWithGap(4)],children:[(0,n.BX)(i.Z,{css:[S.l0.flex.row],children:[(0,n.tZ)(k(),(0,p.Z)((0,d.Z)({passHref:!0},(0,I.j3)(r)),{children:(0,n.tZ)(X,{css:[{color:"inherit"},P,S.l0.flex.growAndShrink(1),S.l0.minWidth(0)],onClick:function(e){return e.preventDefault()},children:(0,n.tZ)(C.x,{variant:"subheadBig",children:r.title})})})),r.isTemplate&&(0,n.tZ)(D,{})]}),r.description?(0,n.tZ)(C.x,{color:"dimmer",maxLines:2,children:r.description}):null]})]})})}),(0,n.BX)(i.Z,{css:[S.l0.rowWithGap(8),S.l0.justify.spaceBetween,S.l0.minHeight(24)],children:[(0,n.tZ)(V.Z,{repl:{id:r.id,runCount:0,likeCount:0,commentCount:0}}),(0,n.tZ)(i.Z,{css:[S.l0.position.relative,{zIndex:1},S.l0.flex.shrink(1)],children:(0,n.tZ)(G.Vs,{tags:r.tags,onTagClick:function(e){return e.preventDefault()}})})]})]})]})}var D=function(){return(0,n.tZ)("span",{css:[S.l0.display.inlineFlex,S.l0.align.center,S.l0.height(24),S.l0.px(8),S.l0.borderRadius(16),S.l0.backgroundColor.yellowDimmest,S.l0.color.yellowStrongest,S.l0.justify.center,S.l0.ml(8),{fontSize:S.TV.fontSizeSmall,lineHeight:S.TV.fontSizeSmall}],children:"Template"})},U=function(){return(0,n.BX)(i.Z,{css:[S.l0.colWithGap(8),{opacity:.5}],children:[(0,n.BX)(i.Z,{css:[S.l0.flex.row,S.l0.align.center,S.l0.flex.grow(1),S.l0.justify.spaceBetween],children:[(0,n.BX)(i.Z,{css:[S.l0.rowWithGap(8),S.l0.align.center],children:[(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(24),S.l0.height(24),S.l0.borderRadius(16)]}),(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(126),S.l0.height(12),S.l0.borderRadius(4)]})]}),(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(12),S.l0.height(12),S.l0.borderRadius(8)]})]}),(0,n.BX)(i.Z,{css:[S.l0.backgroundColor.backgroundDefault,S.l0.width("100%"),S.l0.height(132),S.l0.borderRadius(8),S.l0.colWithGap(8),S.l0.p(8)],children:[(0,n.BX)(i.Z,{css:S.l0.rowWithGap(8),children:[(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.height(84),S.l0.width(84),S.l0.borderRadius(4)]}),(0,n.BX)(i.Z,{css:[S.l0.colWithGap(12),S.l0.pt(4),S.l0.flex.grow(1)],children:[(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(80),S.l0.height(16),S.l0.borderRadius(4)]}),(0,n.BX)(i.Z,{css:S.l0.colWithGap(8),children:[(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width("100%"),S.l0.height(12),S.l0.borderRadius(4)]}),(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width("80%"),S.l0.height(12),S.l0.borderRadius(4)]})]})]})]}),(0,n.BX)(i.Z,{css:[S.l0.flex.row,S.l0.flex.grow(1),S.l0.align.center,S.l0.justify.spaceBetween],children:[(0,n.tZ)(i.Z,{css:S.l0.rowWithGap(16),children:(0,x.Z)(Array(3)).map((function(e,t){return(0,n.BX)(i.Z,{css:[S.l0.rowWithGap(4),S.l0.align.center],children:[(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(12),S.l0.height(12),S.l0.borderRadius(8)]}),(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(16),S.l0.height(8),S.l0.borderRadius(2)]})]},t)}))}),(0,n.tZ)(i.Z,{css:S.l0.rowWithGap(4),children:(0,x.Z)(Array(2)).map((function(e,t){return(0,n.tZ)("span",{css:[S.l0.backgroundColor.backgroundHigher,S.l0.width(48),S.l0.height(24),S.l0.borderRadius(16)]},t)}))})]})]})]})},_=r(51438),H=r(28668),L=r(25892),M=r(25171),A=r(64063),z=r.n(A),N=r(30992),O=r(49483),K=r(98705);function j(e){return e.message||"Something went wrong saving updates to your Repl"}function Y(e){var t,r,n,l,i,a,o;return e.error?e.error.message||"Something went wrong saving your Cover page":"NotFoundError"===(null===(t=e.data)||void 0===t||null===(r=t.setReplViewSettings)||void 0===r?void 0:r.__typename)||"UnauthorizedError"===(null===(n=e.data)||void 0===n||null===(l=n.setReplViewSettings)||void 0===l?void 0:l.__typename)||"UserError"===(null===(i=e.data)||void 0===i||null===(a=i.setReplViewSettings)||void 0===a?void 0:a.__typename)?e.data.setReplViewSettings.message:(null===(o=e.data)||void 0===o?void 0:o.setReplViewSettings)&&"ReplViewSettings"!==e.data.setReplViewSettings.__typename?"Something went wrong saving your Cover page":void 0}function q(e){var t,r,n,l,i,a,o;return e.error?e.error.message||"Something went wrong saving your Repl Tags":"NotFoundError"===(null===(t=e.data)||void 0===t||null===(r=t.setReplTags)||void 0===r?void 0:r.__typename)||"UnauthorizedError"===(null===(n=e.data)||void 0===n||null===(l=n.setReplTags)||void 0===l?void 0:l.__typename)||"UserError"===(null===(i=e.data)||void 0===i||null===(a=i.setReplTags)||void 0===a?void 0:a.__typename)?e.data.setReplTags.message:(null===(o=e.data)||void 0===o?void 0:o.setReplTags)&&"Repl"!==e.data.setReplTags.__typename?"Something went wrong posting your Repl":void 0}var $,Q=r(25475),J=r(60996),ee=r(86292),te=1e3;function re(e){return"repl_file"===e||"repl_image"===e}!function(e){e.ReplFile="repl_file",e.ReplImage="repl_image"}($||($={}));var ne=function(e){(0,H.Z)(r,e);var t=(0,M.Z)(r);function r(){return(0,_.Z)(this,r),t.apply(this,arguments)}return r}((0,L.Z)(Error)),le=function(e){(0,H.Z)(r,e);var t=(0,M.Z)(r);function r(){return(0,_.Z)(this,r),t.apply(this,arguments)}return r}((0,L.Z)(Error)),ie=function(e){(0,H.Z)(r,e);var t=(0,M.Z)(r);function r(){return(0,_.Z)(this,r),t.apply(this,arguments)}return r}((0,L.Z)(Error));function ae(e){return e?e.length>60?{message:"Title should not be more than ".concat(60," characters")}:void 0:{message:"Give your Repl a title"}}function oe(e){return e?e.length>te?{message:"Description should not be more than ".concat(te," characters")}:void 0:{message:"What does this Repl do?"}}function se(e){var t,r,n,i,o,s=(0,N.Y)(e.replId||null,(function(e){return e?null:{message:"Select a Repl to share"}})),u=(0,a.Mq0)({variables:{id:s.value||""},skip:!s.value}),d="Repl"===(null===(t=u.data)||void 0===t?void 0:t.repl.__typename)?u.data.repl:null,p=Boolean(null===d||void 0===d?void 0:d.publishedAs),f=(0,N.Y)("",ae),v=(0,N.Y)("",oe),m=(0,N.Y)(null,(function(){return null})),Z=(0,N.Y)($.ReplImage,(function(){return null})),b=(0,N.Y)(null,(function(){return null})),w=(0,N.Y)("",e.fileValidator),x=(0,N.Y)([],(function(){return null})),y=(0,K.Z)(d),k=(0,N.Y)(!1,(function(e){var t=y.current;return e&&(null===t||void 0===t?void 0:t.lastPublishedAt)?{message:"This Repl has already been published. Please unpublish before publishing as a Template."}:e||(null===t||void 0===t?void 0:t.publishedAs)!==a.O2h.Template?void 0:{message:"This Repl has already been published as a Template. Please unpublish before publishing as a Repl."}})),R=[s,f,v,m,Z,b,x,w,k],C=function(){var e=(0,h.Z)((0,a.F1G)(),2),t=e[0],r=e[1];function n(){return(n=(0,c.Z)(g().mark((function e(n){var l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.loading){e.next=2;break}return e.abrupt("return",{data:null,error:null});case 2:return e.prev=2,e.next=5,t({variables:{input:n}});case 5:return l=e.sent,e.abrupt("return",{data:l.data,error:Y(l)});case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",{data:null,error:"Something went wrong saving your Cover page"});case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}return{data:r.data,loading:r.loading,error:Y(r),setReplViewSettings:function(e){return n.apply(this,arguments)}}}(),B=function(){var e=(0,h.Z)((0,a.nYE)(),2),t=e[0],r=e[1];function n(){return(n=(0,c.Z)(g().mark((function e(n){var l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.loading){e.next=2;break}return e.abrupt("return",{data:null,error:null});case 2:return e.prev=2,e.next=5,t({variables:{input:n}});case 5:return l=e.sent,e.abrupt("return",{data:l.data,error:q(l)});case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",{data:null,error:"Something went wrong saving your Repl Tags"});case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}return{data:r.data,loading:r.loading,error:q(r),setReplTags:function(e){return n.apply(this,arguments)}}}(),S=function(){var e=(0,h.Z)((0,a.NfL)(),2),t=e[0],r=e[1];function n(){return(n=(0,c.Z)(g().mark((function e(n){var l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.loading){e.next=2;break}return e.abrupt("return",{data:null,error:null});case 2:return e.prev=2,e.next=5,t({variables:{input:n}});case 5:return l=e.sent,e.abrupt("return",{data:l.data,error:null});case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",{data:null,error:j(e.t0)});case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}return{data:r.data,loading:r.loading,error:r.error&&j(r.error),updateRepl:function(e){return n.apply(this,arguments)}}}(),V=(0,Q.O)(),G=(0,J.r)(),T=(null===d||void 0===d||null===(r=d.replViewSettings)||void 0===r?void 0:r.defaultView)&&re(d.replViewSettings.defaultView)?d.replViewSettings.defaultView:$.ReplImage,I=(0,K.Z)(f.setValue),F=(0,K.Z)(v.setValue),E=(0,K.Z)(x.setValue),X=(0,K.Z)(m.setValue),P=(0,K.Z)(b.setValue),W=(0,K.Z)(Z.setValue),D=(0,K.Z)(w.setValue),U=(0,K.Z)(k.setValue);(0,l.useEffect)((function(){var e,t,r,n;d&&(U.current("Template"===d.publishedAs),W.current(T),D.current(null!==(t=null===(e=d.replViewSettings)||void 0===e?void 0:e.replFile)&&void 0!==t?t:""),I.current(d.isRenamed?d.title:"",{preventTouch:!0}),F.current(null!==(r=d.description)&&void 0!==r?r:"",{preventTouch:!0}),E.current(d.tags),X.current(d.iconUrl.endsWith(".svg")?null:d.iconUrl),P.current(null!==(n=d.imageUrl)&&void 0!==n?n:null))}),[d,P,X,E,I,F,T,W,D,U]);var _,H=(0,O.W)(m.setValue),L=H.previewUrl||m.value||(null===d||void 0===d?void 0:d.iconUrl)||(null===d||void 0===d?void 0:d.templateInfo.iconUrl),M=null!==(_=null===(n=R.filter((function(e){return(e!==w||Z.value===$.ReplFile)&&e.error})))||void 0===n||null===(i=n[0])||void 0===i||null===(o=i.error)||void 0===o?void 0:o.message)&&void 0!==_?_:null;function A(){return A=(0,c.Z)(g().mark((function e(){var t,r,n,l,i,o,s,c,u,p,h;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d){e.next=3;break}throw new ne("Missing repl");case 3:if(r=d.title!==f.value,n=d.description!==v.value,l=d.iconUrl!==m.value,i="repl_image"===Z.value&&d.imageUrl!==b.value,o=w.value&&"repl_file"===Z.value&&(null===(t=d.replViewSettings)||void 0===t?void 0:t.replFile)!==w.value,s=Z.value&&T!==Z.value,c=!z()(d.tags,x.value),!(r||n||l)){e.next=18;break}if(!(f.error||v.error||m.error)){e.next=13;break}throw new ne;case 13:return e.next=15,S.updateRepl({id:d.id,title:r?f.value:void 0,description:n?v.value:void 0,iconUrl:l?m.value:void 0});case 15:if(!(u=e.sent).error){e.next=18;break}throw new le(u.error);case 18:if(!(s||i||o)){e.next=26;break}if(!(Z.value===$.ReplImage&&b.error||Z.value===$.ReplFile&&w.error)){e.next=21;break}throw new ne;case 21:return e.next=23,C.setReplViewSettings({replId:d.id,defaultView:"repl_image"===Z.value?a.bVG.ReplImage:a.bVG.ReplFile,replImage:i?b.value:void 0,replFile:o?w.value:void 0});case 23:if(!(p=e.sent).error){e.next=26;break}throw new le(p.error);case 26:if(!c){e.next=34;break}if(!x.error){e.next=29;break}throw new ne;case 29:return e.next=31,B.setReplTags({replId:d.id,tags:x.value.map((function(e){return e.id}))});case 31:if(!(h=e.sent).error){e.next=34;break}throw new le(h.error);case 34:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function te(){return(te=(0,c.Z)(g().mark((function t(){var r,n;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d){t.next=2;break}throw new ne("Missing repl");case 2:if(!M){t.next=4;break}throw new ne(null!==M&&void 0!==M?M:"Something went wrong");case 4:if(!k.value){t.next=12;break}return t.next=7,G.createDeployment({input:{replId:d.id,description:v.value,iconUrl:L||d.iconUrl}});case 7:if(!(r=t.sent).error){t.next=10;break}throw new ie(r.error);case 10:return(0,ee.j)(ee.U3.POST_MADE,{source:e.source,replType:"template_repl",title:f.value,description:v.value,tags:x.value.map((function(e){return e.id})),defaultView:Z.value}),t.abrupt("return");case 12:return t.next=14,V.publish({input:{replId:d.id}});case 14:if(!(n=t.sent).error){t.next=17;break}throw new ie(n.error);case 17:(0,ee.j)(ee.U3.POST_MADE,{source:e.source,replType:"regular_repl",title:f.value,description:v.value,tags:x.value.map((function(e){return e.id})),defaultView:Z.value});case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var se=S.loading||C.loading||B.loading,ce=S.error||C.error||B.error,ue=V.loading||G.loading,de=V.error||G.error;return{selectedRepl:d,isReplLoading:u.loading,replLoadingError:u.error,replIdField:s,replTitleField:f,replDescriptionField:v,iconUrlField:m,coverDefaultViewField:Z,coverUrlField:b,coverFileField:w,tagsField:x,isTemplateField:k,replIconInput:H,replIconUrl:L,inputError:M,save:function(){return A.apply(this,arguments)},isSaving:se,savingError:ce,publish:function(){return te.apply(this,arguments)},isPublishing:ue,publishingError:de,isPublished:p}}var ce=l.createContext(null),ue=function(e){var t=l.useContext(ce);if(!t)throw new Error("usePublishField must be used within a PublishInputContext");return t["".concat(e,"Field")]},de=function(){var e=l.useContext(ce);if(!e)throw new Error("usePublishForm must be used within a PublishInputContext");return e},pe=r(72917),he=r(92002),fe=r(96594),ge=r(32951),ve=r(24351),me=r(61179),Ze=/^[0-9a-zA-Z]+$/,be=function(e){return e.id};function we(e){var t=e.onSelect,r=e.filter,n=void 0===r?function(){return!0}:r,i=(0,l.useState)(""),o=i[0],s=i[1],c=(0,ve.Z)(o,100),u=(0,K.Z)(t),d=function(e){var t=e.search,r=e.filter,n=(0,a.zdu)({variables:{limit:t?10:3,search:t}}).data,i=(0,l.useState)({official:[],community:[],newTag:[]}),o=i[0],s=i[1],c=(0,l.useMemo)((function(){if(n){var e=[],l=[],i=new Set,a=!0,o=!1,s=void 0;try{for(var c,u=n.tagGroups.official[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;i.add(d.id.toLowerCase()),r(d)&&e.push(d)}}catch(w){o=!0,s=w}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}var p=!0,h=!1,f=void 0;try{for(var g,v=n.tagGroups.community[Symbol.iterator]();!(p=(g=v.next()).done);p=!0){var m=g.value;i.add(m.id.toLowerCase()),r(m)&&l.push(m)}}catch(w){h=!0,f=w}finally{try{p||null==v.return||v.return()}finally{if(h)throw f}}var Z=l.find((function(e){return e.id===t})),b=!t||Z||i.has(t.toLowerCase())?void 0:{id:t,isOfficial:!1};return{official:e,community:l,newTag:b&&r(b)?[b]:[]}}}),[n,r,t]);return(0,l.useEffect)((function(){if(c){var e=c.official,t=c.community,r=c.newTag;s((function(n){return{official:(0,me.Z)(e,{existing:n.official,getKey:be}),community:(0,me.Z)(t,{existing:n.community,getKey:be}),newTag:r}}))}}),[c]),{tagGroups:o,reset:function(){s({official:[],community:[],newTag:[]})}}}({search:c,filter:n}),p=d.tagGroups,h=d.reset,f=(0,fe.Kb)({inputValue:o,items:(0,x.Z)(p.official).concat((0,x.Z)(p.community),(0,x.Z)(p.newTag)),defaultHighlightedIndex:0,itemToString:function(e){return e?e.id:""},onSelectedItemChange:function(e){e.selectedItem&&(h(),s(""),f.reset(),f.openMenu())}});return(0,ge.Z)((function(){f.selectedItem&&u.current(f.selectedItem)}),[f.selectedItem]),{tagGroups:p,combobox:f,onChange:function(e){var t=e.currentTarget.value;t&&!Ze.test(t)||t.length>30||s(t)}}}var xe=r(44044),ye=r(25019),ke=r(16857),Re=(0,i.K)("ul"),Ce=(0,i.K)("li");function Be(e){var t=e.children;return(0,n.tZ)(i.Z,{css:[S.l0.px(8),S.l0.pt(8)],children:(0,n.tZ)(C.x,{css:[{textTransform:"uppercase"}],variant:"small",color:"dimmer",children:t})})}function Se(e){var t=e.highlighted,r=e.tag;return(0,n.tZ)(i.Z,{css:[S.l0.rowWithGap(8),S.l0.p(8),t&&{backgroundColor:xe.gU.listItem[":not([disabled])"][":active"].backgroundColor},{cursor:"pointer"}],children:(0,n.BX)(i.Z,{css:[S.l0.flex.growAndShrink(1),S.l0.rowWithGap(4)],children:[(0,n.tZ)(C.x,{children:r.id}),r.isOfficial?(0,n.tZ)(ke.Z,{}):null]})})}var Ve=l.memo((function(e){var t=e.getItemProps,r=e.highlightedIndex,l=e.data;return(0,n.tZ)(ye.Z,{css:[S.l0.minWidth(200)],children:l.sections.reduce((function(e,l){return e.sections.push((0,n.BX)(Ce,{children:[(0,n.tZ)(Be,{children:l.title}),(0,n.tZ)(Re,{css:[S.l0.pt(4),S.l0.pb(8)],children:l.tags.map((function(l){var i=e.itemIndex++;return(0,n.tZ)(Ce,(0,p.Z)((0,d.Z)({},t({item:l,index:i})),{children:(0,n.tZ)(Se,{tag:l,highlighted:r===i})}),l.id)}))})]},l.title)),e}),{sections:[],itemIndex:0}).sections})})),Ge=(0,i.K)("div"),Te=(0,i.K)("input"),Ie=(0,R.iv)([S.l0.fontSize(12),S.l0.pl(24),S.l0.pr(8),S.l0.py(4)]);function Fe(){return(0,n.tZ)(C.x,{css:[S.l0.px(4),S.l0.flex.row,S.l0.align.center,S.l0.position.absolute,S.l0.height("100%"),S.l0.color.foregroundDefault,{top:0,left:4,pointerEvents:"none"}],children:(0,n.tZ)(he.Z,{size:12})})}function Ee(e){var t=e.text,r=e.children;return(0,n.BX)(B.Z,{elevated:!0,css:[S.l0.position.relative,S.l0.minWidth(30),S.l0.borderRadius(16),{border:"1px solid transparent","&:focus-within":{borderColor:S.TV.outlineDimmer,backgroundColor:"transparent"}}],children:[(0,n.tZ)(Fe,{}),(0,n.tZ)(C.x,{css:[{visibility:"hidden"},Ie],children:t}),r]})}function Xe(e){var t=e.onSelect,r=we({filter:e.filter,onSelect:t}),a=r.combobox,o=r.tagGroups,s=r.onChange,c=(0,l.useMemo)((function(){return function(e){var t=[];return e.official.length&&t.push({title:"Official Tags",tags:e.official}),e.community.length&&t.push({title:"Community Tags",tags:e.community}),e.newTag.length&&t.push({title:"Create new tag",tags:e.newTag}),0===t.length?null:{type:"sections",sections:t}}(o)}),[o]),u="Add tag";return(0,n.BX)(i.Z,{children:[(0,n.tZ)(Ge,(0,p.Z)((0,d.Z)({},a.getComboboxProps()),{css:[S.l0.flex.row],children:(0,n.tZ)(Ee,{text:a.inputValue||u,children:(0,n.tZ)(Te,(0,d.Z)({css:[S.l0.coverContainer,Ie,S.l0.color.foregroundDefault,{backgroundColor:"transparent","&::placeholder":S.l0.color.foregroundDefault,"&:focus::placeholder":S.l0.color.foregroundDimmest}]},a.getInputProps({placeholder:u,onChange:s,onFocus:function(){a.openMenu()}})))})})),(0,n.tZ)(Ge,(0,p.Z)((0,d.Z)({},a.getMenuProps()),{css:[S.l0.position.relative],children:c&&a.isOpen?(0,n.tZ)(Ve,{getItemProps:a.getItemProps,highlightedIndex:a.highlightedIndex,data:c}):null}))]})}function Pe(e){var t=e.tags,r=e.max,l=void 0===r?5:r,a=e.onAdd,o=e.onRemove,s=t.map((function(e){return e.id}));return(0,n.BX)(i.Z,{css:[S.l0.flex.row,S.l0.flex.wrap,{margin:"calc(-1 * ".concat(S.TV.space4,")")}],children:[t.map((function(e,t){return(0,n.tZ)(i.Z,{css:[S.l0.m(4)],children:(0,n.tZ)(pe.g,{small:!0,tag:e,onClick:function(){return o(t)}})},e.id)})),t.length<l?(0,n.tZ)(i.Z,{css:[S.l0.m(4)],children:(0,n.tZ)(Xe,{onSelect:a,filter:function(e){return!s.includes(e.id.toLowerCase())}})}):null]})}var We=function(){var e=ue("tags");return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(8)],children:[(0,n.tZ)(o.G7,{css:[o.l0.colWithGap(4)],children:(0,n.tZ)(Pe,{max:5,tags:e.value,onAdd:function(t){return e.setValue((0,x.Z)(e.value).concat([t]))},onRemove:function(t){return e.setValue((0,x.Z)(e.value.slice(0,t)).concat((0,x.Z)(e.value.slice(t+1))))}})}),(0,n.BX)(o.G7,{css:o.l0.rowWithGap(4),children:[(0,n.tZ)(o.xv,{color:"dimmer",variant:"small",children:"Adding tags helps others find your Repl."}),(0,n.BX)(o.xv,{color:"dimmest",variant:"small",children:[e.value.length,"/",5]})]})]})},De=r(40963),Ue=r(93604),_e=r(87653),He=r(4306),Le=r(19815),Me=(0,i.K)("div"),Ae=(0,i.K)("li"),ze={searchValue:"",loading:!1,repls:[]};function Ne(e,t){switch(t.type){case"data":var r,n=(null===(r=t.data.currentUser)||void 0===r?void 0:r.publishableReplSearch)||[];return(0,p.Z)((0,d.Z)({},e),{loading:!1,repls:(0,me.Z)(n,{existing:e.repls,getKey:function(e){return e.id}})});case"loading":return(0,p.Z)((0,d.Z)({},e),{loading:!0});case"searchValue":return(0,p.Z)((0,d.Z)({},e),{searchValue:t.searchValue})}}function Oe(e){var t;return e?"".concat(null===(t=e.owner)||void 0===t?void 0:t.username,"/").concat(e.title):""}function Ke(e){var t,r=l.useRef(null);(0,Le.rf)((function(){var t;e.selectedRepl&&(null===(t=r.current)||void 0===t||t.blur())}),[e.selectedRepl]);var a=(null===(t=e.selectedRepl)||void 0===t?void 0:t.iconUrl)&&e.inputValue&&Oe(e.selectedRepl)===e.inputValue?(0,n.tZ)(i.Z,{css:[S.l0.px(8),S.l0.center,{position:"absolute",top:0,left:0,height:"100%"}],children:(0,n.tZ)(T.ZP,{alt:e.selectedRepl.title,iconUrl:e.selectedRepl.iconUrl,size:16})}):null;return(0,n.BX)(i.Z,{css:[{position:"relative"}],children:[(0,n.BX)(Me,(0,p.Z)((0,d.Z)({},e.getComboboxProps()),{css:{position:"relative"},children:[a,(0,n.tZ)(De.ZP,(0,d.Z)({css:[S.l0.pr(32),a&&S.l0.pl(32)]},e.getInputProps({placeholder:"Search for a Repl",onFocus:e.onFocus,ref:r}))),(0,n.tZ)(i.Z,{css:[S.l0.center,S.l0.px(8),{position:"absolute",top:0,right:0,height:"100%"}],children:e.loading&&e.isOpen?(0,n.tZ)(s.Z,{}):(0,n.tZ)(_e.Z,{})})]})),(0,n.tZ)(Me,(0,p.Z)((0,d.Z)({},e.getMenuProps()),{css:{position:"relative"},children:e.isOpen?(0,n.BX)(ye.Z,{children:[e.loading&&0===e.repls.length?(0,n.tZ)(Ae,{css:[S.l0.center,S.l0.py(32)],children:(0,n.tZ)(s.Z,{})}):null,e.loading||0!==e.repls.length?null:(0,n.tZ)(Ae,{css:[S.l0.center,S.l0.py(32)],children:(0,n.tZ)(C.x,{color:"dimmer",variant:"small",children:"No repls found"})}),e.repls.map((function(t,r){return(0,n.tZ)(Ae,(0,p.Z)((0,d.Z)({},e.getItemProps({item:t,index:r})),{children:(0,n.tZ)(He.Z,{filter:"",title:Oe(t),subtitle:(0,Ue.F)(t.timeUpdated),selected:e.selectedRepl===t,highlighted:e.highlightedIndex===r,icon:t.iconUrl?(0,n.tZ)(T.ZP,{iconUrl:t.iconUrl,alt:t.title,size:16}):void 0})}),t.id)}))]}):null}))]})}var je=r(37424);function Ye(e){var t=e.error,r=e.dataCy;return t?(0,n.BX)(o.G7,{css:[o.l0.rowWithGap(4),o.l0.align.center],children:[(0,n.tZ)(v.Z,{css:[o.l0.color.accentNegativeDefault]}),(0,n.tZ)(o.xv,{multiline:!0,css:[o.l0.flex.growAndShrink(1)],dataCy:r,children:t.message})]}):null}var qe=(0,o.KD)("label"),$e=l.forwardRef((function(e,t){return(0,n.tZ)(qe,(0,p.Z)((0,d.Z)({},e),{ref:t,css:o.l0.color.foregroundDimmer}))})),Qe=function(){var e=(0,je.H)()("repl"),t=ue("replId"),r=ue("iconUrl"),i=function(){var e=(0,l.useReducer)(Ne,ze),t=e[0],r=e[1],n=(0,ve.Z)(t.searchValue,200),i=(0,a.b1W)({variables:{search:n},notifyOnNetworkStatusChange:!0,onCompleted:function(e){r({type:"data",data:e})}}).loading;(0,l.useEffect)((function(){i&&r({type:"loading"})}),[i]);var o=(0,l.useCallback)((function(e){return r({type:"searchValue",searchValue:e||""})}),[]);return{repls:t.repls,loading:t.loading,searchValue:t.searchValue,setSearchValue:o}}(),s=(0,fe.Kb)({id:e,items:i.repls,initialHighlightedIndex:-1,onInputValueChange:function(e){var t=e.inputValue;i.setSearchValue(t)},onSelectedItemChange:function(e){(null===e||void 0===e?void 0:e.selectedItem)&&(t.setValue(e.selectedItem.id),s.closeMenu())},itemToString:Oe});return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(4)],children:[(0,n.tZ)($e,{css:o.l0.color.foregroundDimmer,htmlFor:e,children:"Repl"}),(0,n.tZ)(Ke,{getComboboxProps:s.getComboboxProps,getInputProps:s.getInputProps,getItemProps:s.getItemProps,getMenuProps:s.getMenuProps,isOpen:s.isOpen,highlightedIndex:s.highlightedIndex,inputValue:s.inputValue,selectedRepl:s.selectedItem?(0,p.Z)((0,d.Z)({},s.selectedItem),{iconUrl:r.value||s.selectedItem.iconUrl}):void 0,repls:i.repls,loading:i.loading,onFocus:function(e){s.selectedItem&&(e.preventDefault(),e.currentTarget.select(),i.setSearchValue("")),s.openMenu()}})]})},Je=function(){var e=(0,je.H)(),t=e("replName"),r=e("replDescription"),l=de(),i=l.replIdField,a=l.replTitleField,s=l.replDescriptionField,c=l.isSaving,u=l.selectedRepl,d=u&&!u.isRenamed?"Default name: ".concat(u.title):"Enter a name for your Repl";return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(16),o.l0.flex.growAndShrink(1)],children:[(!i.value||i.touched)&&(0,n.tZ)(Qe,{}),(0,n.BX)(o.G7,{css:[o.l0.colWithGap(4)],children:[(0,n.BX)(o.G7,{css:[o.l0.flex.row,o.l0.align.baseline,o.l0.justify.spaceBetween],children:[(0,n.tZ)($e,{css:[o.l0.color.foregroundDimmer,{lineHeight:o.TV.lineHeightSmall}],htmlFor:t,children:"Repl name"}),(0,n.BX)(o.xv,{css:{color:a.value.length>60?o.TV.accentNegativeStronger:o.TV.foregroundDimmest},children:[a.value.length,"/",60]})]}),(0,n.tZ)(o.II,{id:t,disabled:!i.value||c,value:a.value,onChange:function(e){a.setValue(e.currentTarget.value)},placeholder:d,dataCy:"publish-form-repl-title-input"}),a.touched&&(0,n.tZ)(Ye,{error:a.error,dataCy:"publish-form-repl-title-error"})]}),(0,n.BX)(o.G7,{css:[o.l0.colWithGap(4)],children:[(0,n.BX)(o.G7,{css:[o.l0.flex.row,o.l0.align.baseline,o.l0.justify.spaceBetween],children:[(0,n.tZ)($e,{css:[o.l0.color.foregroundDimmer,{lineHeight:o.TV.lineHeightSmall}],htmlFor:r,children:"Repl description"}),(0,n.BX)(o.xv,{css:{color:s.value.length>te?o.TV.accentNegativeStronger:o.TV.foregroundDimmest},children:[s.value.length,"/",te]})]}),(0,n.tZ)(o.B,{id:r,value:s.value,disabled:!i.value||c,onChange:function(e){s.setValue(e.currentTarget.value)},placeholder:"What does this Repl do?",css:[o.l0.minHeight(128),o.l0.maxHeight(256),{resize:"vertical"}],dataCy:"publish-form-repl-description-input"}),s.touched&&(0,n.tZ)(Ye,{error:s.error,dataCy:"publish-form-repl-description-error"})]})]})},et=function(e){var t=e.showPlayButton,r=e.children;return(0,n.BX)("div",{css:{position:"relative",aspectRatio:"".concat(268,"/").concat(164),overflow:"hidden"},children:[(0,n.tZ)("div",{css:{position:"absolute",top:"calc(".concat(18," / ").concat(164," * 100%)"),bottom:"calc(".concat(1," / ").concat(164," * 100%)"),left:"calc(".concat(1," / ").concat(268," * 100%)"),right:"calc(".concat(1," / ").concat(268," * 100%)"),borderBottomLeftRadius:4,borderBottomRightRadius:4,overflow:"hidden"},children:r}),(0,n.BX)("svg",{viewBox:"0 0 268 164",fill:"none",xmlns:"http://www.w3.org/2000/svg",css:{position:"relative"},children:[(0,n.tZ)("rect",{width:"268",height:"17",fill:o.TV.backgroundDefault}),(0,n.tZ)("rect",{x:"241.5",y:"4.5",width:"22",height:"10",rx:"2",fill:o.TV.accentPositiveDimmer}),(0,n.tZ)("rect",{x:"228.5",y:"4.5",width:"10",height:"10",rx:"2",fill:o.TV.backgroundHighest}),(0,n.tZ)("rect",{x:"4.5",y:"4.5",width:"32",height:"10",rx:"2",fill:o.TV.backgroundHighest}),(0,n.tZ)("rect",{x:"1",y:"18",width:"266",height:"1",fill:o.TV.outlineDimmer}),t&&(0,n.tZ)("path",{d:"M142.225 90.5642C142.565 90.7554 142.565 91.2446 142.225 91.4358L127.745 99.5809C127.412 99.7683 127 99.5275 127 99.1451L127 82.8549C127 82.4725 127.412 82.2317 127.745 82.4191L142.225 90.5642Z",fill:o.TV.white}),(0,n.tZ)("rect",{x:"1",y:"1",width:"266",height:"162",rx:"4",stroke:o.TV.outlineDimmer,strokeWidth:"1"})]})]})},tt=r(62722),rt=function(e){var t=function(e){var t=l.useRef(null),r={onClick:function(e){var r;return e.preventDefault(),e.stopPropagation(),null===(r=t.current)||void 0===r?void 0:r.click()}};return{inputProps:{onChange:function(t){var r=t.target,n=r.validity,l=r.files;if(n.valid){var i=l?l[0]:null;i&&e(i)}},"aria-hidden":"true",ref:t,accept:tt.W9.join(","),type:"file"},buttonProps:r,inputRef:t}}(e.onFile),r=t.inputProps,i=t.buttonProps;return(0,n.BX)(n.HY,{children:[(0,n.tZ)("input",(0,p.Z)((0,d.Z)({},r),{css:{display:"none"}})),l.cloneElement(e.children,i)]})},nt=r(15833),lt=r(48551);function it(e){return e.slice().sort((function(e,t){return e.localeCompare(t)})).map((function(e){return{file:e,pathDepth:(0,lt.U$)(e)}})).sort((function(e,t){return e.pathDepth-t.pathDepth})).map((function(e){return e.file}))}var at=(0,o.KD)("ol"),ot=(0,o.KD)("li"),st=(0,R.iv)([S.l0.py(4),S.l0.borderRadius(8),{border:"1px solid ".concat(o.TV.outlineDimmest),borderRadius:o.TV.borderRadius8,backgroundColor:o.vb.interactiveBackground,zIndex:o.n0,maxHeight:300,position:"absolute",overflowY:"auto",width:"100%",left:0,top:o.TV.space8,listStyle:"none"}]),ct={backgroundColor:o.vb.interactiveBackgroundActive},ut={backgroundColor:o.TV.accentPrimaryDefault},dt=(0,R.iv)([S.l0.p(8),{":not([disabled])":{cursor:"pointer",":hover":(0,d.Z)({},ct),":active":(0,d.Z)({},ut)}}]);function pt(e){var t=e.fs,r=e.initiallySelectedFile,i=e.onFileSelect,a=e.onClear,s=l.useRef(null),u=function(e){var t=e.fs,r=(0,h.Z)(l.useState({isLoading:!0,error:null,files:[]}),2),n=r[0],i=r[1];return l.useEffect((function(){function e(){return(e=(0,c.Z)(g().mark((function e(){var r,n,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.listFiles();case 3:if(!(r=e.sent).error){e.next=6;break}throw new Error(r.error);case 6:l=it(null!==(n=r.files)&&void 0!==n?n:[]),i({isLoading:!1,error:null,files:l}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),i({isLoading:!1,error:"Could not load files",files:[]});case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),(0,d.Z)({},n)}({fs:t}),f=u.isLoading,v=u.files,m=u.error,Z=function(e){var t=e.files,r=e.inputRef,n=e.initiallySelectedFile,i=(0,h.Z)(l.useState(!1),2),a=i[0],o=i[1],s=(0,h.Z)(l.useState(t),2),c=s[0],u=s[1],f=l.useCallback((function(e){return t.filter((function(t){return t.toLowerCase().includes(e.toLowerCase())}))}),[t]),g=(0,fe.Kb)({items:c,isOpen:a,initialInputValue:n,initialSelectedItem:c.find((function(e){return e===n})),onIsOpenChange:function(e){o(Boolean(e.isOpen))},onInputValueChange:function(e){var t;u(f(null!==(t=e.inputValue)&&void 0!==t?t:""))}}),v=l.useCallback((function(){var e;o(!1),null===(e=r.current)||void 0===e||e.blur()}),[r]);return l.useEffect((function(){var e;u(f(null!==(e=g.inputValue)&&void 0!==e?e:""))}),[t,f,g.inputValue]),l.useEffect((function(){g.selectedItem&&v()}),[g.selectedItem,v]),(0,p.Z)((0,d.Z)({},g),{closeMenu:v,items:c})}({files:v,inputRef:s,initiallySelectedFile:r}),b=(0,K.Z)(i);return l.useEffect((function(){Z.selectedItem&&b.current(Z.selectedItem)}),[Z.selectedItem,b]),(0,n.BX)(o.G7,{children:[(0,n.tZ)(o.G7,(0,p.Z)((0,d.Z)({},Z.getComboboxProps({refKey:"innerRef"})),{css:[S.l0.position.relative],children:(0,n.tZ)(o.E1,(0,p.Z)((0,d.Z)({},Z.getInputProps({onFocus:Z.openMenu,ref:s,refKey:"inputRef",disabled:f,placeholder:"Search your files"})),{onClear:function(){var e;Z.reset(),null===(e=s.current)||void 0===e||e.focus(),a()},loading:f}))})),(0,n.BX)(o.G7,(0,p.Z)((0,d.Z)({},Z.getMenuProps({refKey:"innerRef"})),{css:[S.l0.position.relative],children:[m&&(0,n.tZ)(o.G7,{css:[S.l0.p(8)],children:(0,n.tZ)(o.xv,{children:"Something went wrong loading your files. Please try again."})}),!m&&Z.isOpen&&(0,n.tZ)(at,{css:[st],children:Z.items.length>0?Z.items.map((function(e,t){return(0,n.tZ)(ot,(0,p.Z)((0,d.Z)({css:[dt,Z.highlightedIndex===t&&ct,e===Z.selectedItem&&ut]},Z.getItemProps({item:e,index:t,onClick:function(){Z.closeMenu()}})),{children:(0,n.tZ)(o.xv,{children:e})}),e)})):(0,n.tZ)(ot,{css:[S.l0.p(8)],children:(0,n.BX)(o.xv,{children:['No files found for "',Z.inputValue,'"']})})})]}))]})}var ht=r(7657),ft=r(41307),gt=[{value:$.ReplImage,text:"Photo"},{value:$.ReplFile,text:"File"}],vt=function(e){var t=e.fs,r=(0,je.H)(),l=r("coverPage"),i=de(),a=i.selectedRepl,s=i.coverFileField,c=i.coverUrlField,u=i.coverDefaultViewField,d=(0,O.W)(c.setValue);return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(16)],children:[(0,n.BX)(o.G7,{css:o.l0.colWithGap(12),children:[(0,n.tZ)(o.G7,{css:[o.l0.rowWithGap(8)],children:(0,n.tZ)(o.Ee,{tag:"fieldset",css:[o.l0.rowWithGap(24)],name:l,value:u.value,onChange:function(e){re(e.target.value)&&u.setValue(e.target.value)},children:gt.map((function(e){return(0,n.BX)(o.G7,{css:[o.l0.rowWithGap(8)],children:[(0,n.tZ)(o.Y8,{id:r(e.value),value:e.value}),(0,n.tZ)("label",{htmlFor:r(e.value),children:e.text})]},e.value)}))})}),u.value===$.ReplImage&&(0,n.tZ)(n.HY,{children:(0,n.tZ)(rt,{onFile:function(e){return d.uploadImage(e,ht.N.ReplCoverImage)},children:(0,n.tZ)(o.zx,{text:"Upload a cover photo",iconLeft:(0,n.tZ)(nt.Z,{})})})}),u.value===$.ReplFile&&(0,n.BX)(o.G7,{css:[o.l0.colWithGap(4)],children:[(0,n.tZ)(pt,{fs:t,initiallySelectedFile:s.value,onFileSelect:s.setValue,onClear:function(){return s.setValue("")}},null===a||void 0===a?void 0:a.id),(0,n.tZ)(Ye,{error:s.error})]})]}),u.value===$.ReplImage&&(0,n.tZ)(et,{showPlayButton:u.value===$.ReplImage&&!!c.value,children:u.value===$.ReplImage&&!!c.value&&(0,n.tZ)(ft.y,{src:c.value,alt:"cover"})})]})},mt=r(67629),Zt=function(){var e=ue("iconUrl"),t=de(),r=t.replIconInput,l=t.replIconUrl,i=Boolean(e.value&&!e.value.endsWith(".svg"));return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(16),o.l0.align.center],children:[(0,n.BX)(o.G7,{css:[o.l0.colWithGap(8)],children:[(0,n.BX)(o.G7,{css:[o.l0.rowWithGap(8)],children:[(0,n.tZ)(rt,{onFile:function(e){return r.uploadImage(e,ht.N.ReplIcon)},css:o.l0.backgroundColor.accentNegativeDefault,children:(0,n.tZ)(o.zx,{text:i?"Change image":"Upload image",iconLeft:(0,n.tZ)(nt.Z,{}),css:[o.l0.backgroundColor.backgroundHigher],type:"button",stretch:!0})}),i&&(0,n.tZ)(o.zx,{text:"Remove image",onClick:function(){return e.setValue(null)},css:[o.l0.color.accentNegativeStronger,o.l0.backgroundColor.backgroundHigher],iconLeft:(0,n.tZ)(mt.Z,{}),type:"button"})]}),r.error?(0,n.tZ)(o.G7,{children:(0,n.tZ)(o.E_,{icon:(0,n.tZ)(v.Z,{}),colorway:"negative",text:r.error,closable:!0,closeAction:r.clearError})}):null]}),(0,n.tZ)(T.LN,{alt:"icon",size:84,iconUrl:l,isLoading:Boolean(r.previewUrl),css:[o.l0.backgroundColor.backgroundHigher]})]})},bt=r(92876),wt=r(18962),xt=r(45528),yt=r(66223),kt=r(5783),Rt=r(99336),Ct=r(59916);function Bt(e){var t=e.repl,r=e.currentUser,n=(0,h.Z)(l.useState(""),2),i=n[0],a=n[1],o=(0,h.Z)(l.useState((function(){return function(e){var t=e.setBsodSentryEventId,r=(0,kt.Z)({onUnrecoverableError:function(e){bt.Tb(e);var r=(0,Rt.ZP)(e,{tags:{publish2:"true"}});t(r)}}),n=(0,yt.Z)({container:r});return{container:r,fs:n,dotReplit:(0,Ct.Z)({container:r,fs:n})}}({setBsodSentryEventId:a})})),1),s=o[0],c=s.container,u=s.fs,d=s.dotReplit,p=(0,h.Z)(l.useState((function(){return c.getConnectionState()===wt.e.CONNECTED})),2),f=p[0],g=p[1],v=(0,xt.b)(t?{repl:t,currentUser:r}:null);return l.useEffect((function(){if(t&&v&&c.getConnectionState()===wt.e.DISCONNECTED)return c.connect({context:v}),function(){return c.close()}}),[t,c,v]),l.useEffect((function(){return c.onConnectionStateChanged((function(e){g(e===wt.e.CONNECTED)}))}),[c]),{isConnected:f,container:c,fs:u,dotReplit:d,didBsod:Boolean(i),devClearBsod:function(){return a("")}}}var St=r(22862),Vt=r(65456);var Gt=r(88075),Tt=(0,o.KD)("button"),It=function(){return(0,n.tZ)(i.Z,{css:[o.l0.flex.row,o.l0.flex.grow(1),{borderTop:"1px solid ".concat(o.TV.outlineDimmest)}]})},Ft=function(e){var t=e.isActive,r=e.isComplete,l=e.children,i=e.onClick,a=e.disabled;return(0,n.BX)(Tt,{type:"button",css:[o.d$,o.l0.position.relative,o.gU.nofill,t&&o.l0.backgroundColor.backgroundHigher,o.l0.p(4),o.l0.borderRadius(4)],onClick:i,disabled:a,children:[(0,n.tZ)(o.xv,{variant:"small",children:l}),r&&(0,n.tZ)(Gt.Z,{size:6,strokeWidth:6,color:o.TV.foregroundDimmer,css:[o.l0.position.absolute,{top:2,right:-2}]})]})},Et=function(){var e=ue("isTemplate"),t=(0,je.H)()("templateCheckbox");return(0,n.BX)(o.G7,{css:[o.l0.colWithGap(8)],children:[(0,n.BX)(o.G7,{css:[o.l0.colWithGap(8)],children:[(0,n.BX)(o.G7,{css:[o.l0.rowWithGap(8)],children:[(0,n.tZ)(o.XZ,{id:t,checked:e.value,onChange:function(t){return e.setValue(t.target.checked)}}),(0,n.tZ)("label",{htmlFor:t,children:"Publish Repl as a Template"})]}),(0,n.tZ)(Ye,{error:e.error})]}),(0,n.tZ)(o.xv,{variant:"small",color:"dimmer",multiline:!0,children:"This is a good option for Repls meant as starting points for future work."}),(0,n.tZ)(o.xv,{variant:"small",multiline:!0,css:o.l0.color.orangeStrongest,children:"Please include a README or other explanation of your template in order to be considered for a feature."})]})},Xt=r(98032),Pt=(0,o.KD)("form"),Wt=function(e){var t=e.user,r=de(),l=r.selectedRepl,i=r.replTitleField,a=r.replDescriptionField,c=r.replIconUrl,h=r.tagsField,f=r.isTemplateField;return(0,n.BX)(o.Tg,{background:"root",css:[(0,u.Z)({},(0,w.et)("tabletMin"),{display:"flex"}),o.l0.flex.growAndShrink(1),o.l0.p(16),o.l0.colWithGap(12),o.l0.align.center,o.l0.display.none],children:[(0,n.tZ)(o.xv,{variant:"small",color:"dimmer",css:[o.l0.width("100%"),{fontWeight:o.TV.fontWeightMedium}],children:"Preview"}),(0,n.BX)(o.G7,{css:[o.l0.width("100%"),o.l0.maxWidth(432),o.l0.position.relative],children:[(0,n.tZ)(o.G7,{css:{position:"absolute",zIndex:2,inset:0,boxShadow:"inset 0 48px 24px -24px "+o.TV.backgroundRoot+", inset 0 -48px 24px -24px "+o.TV.backgroundRoot}}),(0,n.BX)(o.G7,{css:[o.l0.height(416),o.l0.colWithGap(24),o.l0.justify.center,o.l0.overflow("hidden"),o.l0.backgroundColor.backgroundRoot],children:[(0,n.tZ)(U,{}),l&&c?(0,n.tZ)(W,{post:{user:t,repl:(0,p.Z)((0,d.Z)({},l),{title:i.value,iconUrl:c,tags:h.value,description:a.value,isTemplate:f.value})}}):(0,n.tZ)(o.G7,{css:[o.l0.flex.grow(1),o.l0.align.center,o.l0.justify.center],children:(0,n.tZ)(s.Z,{})}),(0,n.tZ)(U,{})]})]})]})},Dt=["Basics","Tags","Icon","Cover page","More"];function Ut(e){var t=e.replId,r=e.currentUser,i=e.source,a=function(){var e=(0,c.Z)(g().mark((function e(t){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H){e.next=2;break}return e.abrupt("return",{message:"Could not get file"});case 2:if(t){e.next=4;break}return e.abrupt("return",{message:"File path cannot be blank"});case 4:return e.prev=4,e.next=7,H.stat(t);case 7:if((r=e.sent).exists&&r.type===Vt.Tv.File){e.next=10;break}return e.abrupt("return",{message:"File does not exist"});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",{message:"Could not get file"});case 15:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}(),p=se({replId:t,fileValidator:a,source:i}),f=p.selectedRepl,x=p.isReplLoading,y=p.replLoadingError,k=p.replIdField,R=p.replTitleField,C=p.replDescriptionField,B=p.iconUrlField,S=p.tagsField,V=p.coverDefaultViewField,G=p.coverUrlField,T=p.coverFileField,I=p.isTemplateField,F=p.save,E=p.isSaving,X=p.savingError,P=p.publish,W=p.isPublishing,D=p.publishingError,U=p.isPublished,_=Bt({repl:f,currentUser:r}),H=_.fs,L=_.dotReplit,M=_.didBsod,A=_.devClearBsod,z=(0,h.Z)(l.useState(0),2),N=z[0],O=z[1],j=Dt[N],Y=N===Dt.length-1,q=(0,h.Z)(l.useState({show:!1,isUpdate:!1}),2),Q=q[0],J=q[1],te=(0,h.Z)(l.useState((function(){return Array(Dt.length).fill(!1)})),2),re=te[0],ne=te[1],le=l.useCallback((function(e,t){var r=re;r[e]=t,ne(r)}),[re]);l.useEffect((function(){p.replTitleField.value&&p.replDescriptionField.value?le(0,!0):le(0,!1),p.tagsField.value.length>0?le(1,!0):le(1,!1),p.iconUrlField.value?le(2,!0):le(2,!1),p.coverDefaultViewField.value===$.ReplImage&&p.coverUrlField.value||p.coverDefaultViewField.value===$.ReplFile&&p.coverFileField.value?le(3,!0):le(3,!1)}),[re,p,le]);var ie=function(e){var t=e.dotReplit,r=(0,h.Z)(l.useState({isLoading:!0,error:null,entryPoint:null}),2),n=r[0],i=r[1];return l.useEffect((function(){function e(){return e=(0,c.Z)(g().mark((function e(){var r,n,l;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,t.getConfig();case 4:if(!(n=e.sent).error){e.next=7;break}throw new Error(n.errorMessage);case 7:i({isLoading:!1,error:null,entryPoint:null!==(l=null===n||void 0===n||null===(r=n.config)||void 0===r?void 0:r.entrypoint)&&void 0!==l?l:null}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),i({isLoading:!1,error:"Could not load .replit config",entryPoint:null});case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),e.apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),(0,d.Z)({},n)}({dotReplit:L});l.useEffect((function(){ie.isLoading||!ie.entryPoint||T.value||T.setValue(ie.entryPoint)}),[ie.isLoading,ie.entryPoint,T]);var ae=(0,h.Z)(l.useState(!1),2),oe=ae[0],ue=ae[1];l.useEffect((function(){oe||t&&(x||U)||(ue(!0),(0,ee.j)(ee.U3.PUBLISH_SELECTED,{source:i}))}),[oe,i,t,x,U]);var de=(0,K.Z)(Boolean((null===f||void 0===f?void 0:f.publishedAs)||(null===f||void 0===f?void 0:f.lastPublishedAt))),pe=(0,K.Z)(j);if(l.useEffect((function(){return function(){de.current||(0,ee.j)(ee.U3.PUBLISH_FLOW_EXITED,{source:i,lastSectionVisited:pe.current})}}),[i,de,pe]),M)return(0,n.tZ)(St.Z,{devHide:A});if(Q.show&&f)return(0,n.tZ)(Xt.q,{repl:f,isUpdate:Q.isUpdate});var he,fe={Basics:{hasError:Boolean(k.error||R.error||C.error),isValid:(0,c.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([k.validate(),R.validate(),C.validate()]);case 2:return e.abrupt("return",e.sent.every((function(e){return!e})));case 3:case"end":return e.stop()}}),e)})))},Tags:{hasError:Boolean(S.error),isValid:(0,c.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.validate();case 2:return e.abrupt("return",!e.sent);case 3:case"end":return e.stop()}}),e)})))},Icon:{hasError:Boolean(B.error),isValid:(0,c.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.validate();case 2:return e.abrupt("return",!e.sent);case 3:case"end":return e.stop()}}),e)})))},"Cover page":{hasError:Boolean(V.value===$.ReplImage?G.error:T.error),isValid:(0,c.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V.value!==$.ReplImage){e.next=6;break}return e.next=3,G.validate();case 3:e.t0=!e.sent,e.next=9;break;case 6:return e.next=8,T.validate();case 8:e.t0=!e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)})))},More:{hasError:Boolean(I.error),isValid:(0,c.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I.validate();case 2:return e.abrupt("return",!e.sent);case 3:case"end":return e.stop()}}),e)})))}},ge=fe[j].hasError,ve=fe[j].isValid,me=null!==(he=Dt.find((function(e){return fe[e].hasError})))&&void 0!==he?he:null,Ze=null;f?y||X||D?Ze="Something went wrong - please try again":ge&&(Ze="Please fill out the the form"):Ze="Please select a Repl";var be=Boolean(!f||ge||y||x||E||W),we=function(){var e=(0,c.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=be,e.t0){e.next=5;break}return e.next=4,ve();case 4:e.t0=!e.sent;case 5:if(!e.t0){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,F();case 10:O(t),e.next=16;break;case 13:return e.prev=13,e.t1=e.catch(7),e.abrupt("return");case 16:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t){return e.apply(this,arguments)}}();return(0,n.tZ)(ce.Provider,{value:p,children:(0,n.BX)(o.Tg,{css:[o.l0.borderRadius(8),o.l0.flex.row,o.l0.overflow("hidden"),(0,u.Z)({},(0,w.et)("tabletMax"),{minWidth:850})],background:"default",dataCy:"publish-form-container",children:[(0,n.BX)(o.G7,{css:[o.l0.colWithGap(12),o.l0.p(16),o.l0.minWidth(320),o.l0.flex.growAndShrink(1),(0,u.Z)({},(0,w.et)("tabletMin"),{maxWidth:320})],children:[(0,n.tZ)(o.xv,{variant:"subheadBig",children:U?"Edit Publish Settings":"Publish ".concat(t?"this":"a"," Repl")}),(0,n.BX)(Pt,{onSubmit:function(){var e=(0,c.Z)(g().mark((function e(t){var r,n,l,i,a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!Y){e.next=39;break}r=!0,n=!1,l=void 0,e.prev=3,i=Dt[Symbol.iterator]();case 5:if(r=(a=i.next()).done){e.next=14;break}return o=a.value,e.next=9,fe[o].isValid();case 9:if(e.sent){e.next=11;break}return e.abrupt("return");case 11:r=!0,e.next=5;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),n=!0,l=e.t0;case 20:e.prev=20,e.prev=21,r||null==i.return||i.return();case 23:if(e.prev=23,!n){e.next=26;break}throw l;case 26:return e.finish(23);case 27:return e.finish(20);case 28:if(U){e.next=34;break}return e.next=31,P();case 31:J({show:!0,isUpdate:!1}),e.next=37;break;case 34:return e.next=36,F();case 36:J({show:!0,isUpdate:!0});case 37:e.next=40;break;case 39:we(N+1);case 40:case"end":return e.stop()}}),e,null,[[3,16,20,28],[21,,23,27]])})));return function(t){return e.apply(this,arguments)}}(),css:[o.l0.colWithGap(16),o.l0.flex.growAndShrink(1)],children:[(0,n.tZ)(o.G7,{css:[o.l0.rowWithGap(4),o.l0.align.center],children:Dt.map((function(e,t){return(0,n.BX)(l.Fragment,{children:[0!==t&&(0,n.tZ)(It,{}),(0,n.tZ)(Ft,{isActive:N===t,isComplete:re[t],onClick:function(){return we(t)},disabled:be,children:e})]},e)}))}),(0,n.BX)(o.G7,{css:o.l0.flex.growAndShrink(1),children:["Basics"===j&&(0,n.tZ)(Je,{}),"Tags"===j&&(0,n.tZ)(We,{}),"Icon"===j&&(0,n.tZ)(Zt,{}),"Cover page"===j&&(0,n.tZ)(vt,{fs:H}),"More"===j&&(0,n.tZ)(Et,{})]}),(0,n.BX)(o.G7,{children:[Y&&me&&me!==j&&(0,n.tZ)(o.E_,{colorway:"negative",icon:(0,n.tZ)(v.Z,{}),text:"Please fix error in ".concat(me," section")}),X&&(0,n.tZ)(o.E_,{colorway:"negative",icon:(0,n.tZ)(v.Z,{}),text:X}),D&&(0,n.tZ)(o.E_,{colorway:"negative",icon:(0,n.tZ)(v.Z,{}),text:D})]}),(0,n.BX)(o.G7,{css:[o.l0.rowWithGap(8),o.l0.justify.spaceBetween,o.l0.align.center],children:[(0,n.tZ)(o.zx,{css:[0===N&&o.l0.visibility.hidden],type:"button",iconLeft:(0,n.tZ)(Z.Z,{}),disabled:be,onClick:function(){return we(N-1)},text:"Back"}),E&&(0,n.tZ)(o.G7,{css:[o.l0.rowWithGap(4),o.l0.color.foregroundDimmer],children:(0,n.tZ)(s.Z,{})}),(0,n.BX)(o.u,{tooltip:Ze,placement:"bottom",isDisabled:!Ze,children:[!Y&&(0,n.tZ)(o.zx,{type:"submit",colorway:"primary",iconLeft:(0,n.tZ)(b.Z,{}),disabled:be,text:"Next",dataCy:"publish-form-next-button"}),Y&&!U&&(0,n.tZ)(o.zx,{type:"submit",colorway:"primary",css:[{boxShadow:"0px 0px 16px 0px ".concat(o.TV.accentPrimaryDimmer," !important")}],iconLeft:(0,n.tZ)(m.Z,{}),disabled:Boolean(be||me),text:W?"Publishing...":"Publish to Community",dataCy:"publish-form-publish-button"}),Y&&U&&(0,n.tZ)(o.zx,{type:"submit",colorway:"primary",iconLeft:(0,n.tZ)(m.Z,{}),disabled:Boolean(be||me),text:E?"Saving...":"Save"})]})]})]})]}),(0,n.tZ)(Wt,{user:r})]})})}var _t=r(86127);function Ht(e){var t,r,c=e.replId,u=e.source;l.useEffect(_t.S,[]);var d=(0,a.NHW)(),p="CurrentUser"===(null===(t=d.data)||void 0===t||null===(r=t.currentUser)||void 0===r?void 0:r.__typename)?d.data.currentUser:null;return d.loading?(0,n.tZ)(i.Z,{css:[o.l0.center,o.l0.p(32)],children:(0,n.tZ)(s.Z,{})}):d.error||!p?(0,n.tZ)(i.Z,{css:[o.l0.center,o.l0.p(32)],children:(0,n.tZ)(o.xv,{children:"Something went wrong, please try again."})}):(0,n.tZ)(Ut,{source:u,replId:c,currentUser:p})}},98032:function(e,t,r){r.d(t,{q:function(){return w}});var n=r(26042),l=r(69396),i=r(10253),a=r(35944),o=r(67294),s=r(60731),c=r(90317),u=r(41664),d=r.n(u),p=r(88046),h=r(79500),f=r(41034),g=r(85565),v=r(9517),m=r(11163),Z="https://twitter.com/intent/tweet";var b=function(e){var t=e.url,r=e.successMessageDurationMs,n=void 0===r?1500:r,l=(0,i.Z)(o.useState(!1),2),c=l[0],u=l[1],d=o.useRef(null);return o.useEffect((function(){return function(){d.current&&clearTimeout(d.current)}}),[]),(0,a.tZ)(s.u,{isOpen:c,placement:"bottom",tooltip:c?"Copied!":"Copy link",delay:0,children:(0,a.tZ)(s.hU,{alt:"Copy link",tooltipHidden:!1,onClick:function(){t&&((0,h.Z)(t),u(!0),d.current=setTimeout((function(){u(!1)}),n))},children:(0,a.tZ)(f.Z,{})})})},w=function(e){var t=e.repl,r=e.isUpdate,i=(0,m.useRouter)(),o=(0,p.j3)(t),u=t.url?(0,p.QB)(t):"",h=t.publishedAs===c.O2h.Template,f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.text,r=e.url,n=e.hashtags,l=e.via,i=new URLSearchParams;t&&i.append("text",t),r&&i.append("url",r),n&&i.append("hashtags",n.join(",")),l&&i.append("via",l);var a=i.toString();return a.length>0?"".concat(Z,"?").concat(a):Z}({text:"Check out what I just published on Replit: ".concat(t.title),url:u});return(0,a.BX)(s.Tg,{background:"default",css:[s.l0.borderRadius(8),s.l0.p(16),s.l0.overflow("hidden"),s.l0.colWithGap(16)],dataCy:"published-repl-share-info-container",children:[(0,a.BX)(s.G7,{css:[s.l0.colWithGap(16)],children:[(0,a.BX)(s.xv,{variant:"subheadBig",children:[h?"Template":"Repl"," ",r?"updated":"published","!"]})," ",(0,a.BX)(s.G7,{css:[s.l0.colWithGap(4)],children:[(0,a.tZ)(s.xv,{variant:"small",css:[s.l0.color.foregroundDimmer],children:"Cover page link"}),(0,a.BX)(s.G7,{css:[s.l0.rowWithGap(4),s.l0.align.center],children:[(0,a.tZ)(d(),(0,l.Z)((0,n.Z)({},o),{css:[s.l0.flex.growAndShrink(1)],children:(0,a.tZ)("a",{css:[{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}],children:u})})),(0,a.tZ)(b,{url:u})]})]})]}),(0,a.BX)(s.G7,{css:[s.l0.rowWithGap(16),s.l0.justify.spaceBetween,{alignItems:"flex-end"}],children:[(0,a.BX)(s.G7,{css:[s.l0.colWithGap(8)],children:[(0,a.tZ)(s.xv,{variant:"small",css:[s.l0.color.foregroundDimmer],children:"Share to"}),(0,a.BX)("a",{href:f,target:"_blank",rel:"noopener noreferrer",css:[s.l0.display.flex,s.l0.colWithGap(2),s.l0.color.foregroundDefault,s.l0.align.center],children:[(0,a.tZ)(g.Z,{}),(0,a.tZ)(s.xv,{children:"Twitter"})]})]}),(0,a.tZ)(s.G7,{children:(0,a.tZ)(s.zx,{type:"button",iconRight:(0,a.tZ)(v.Z,{}),text:h?"Go to Templates":"Go to Community",onClick:function(){h?i.push("/templates"):i.push({pathname:"/postsFeed",query:{order:"new"}},{pathname:"/community/all",query:{order:"new"}})}})})]})]})}},60996:function(e,t,r){r.d(t,{r:function(){return u}});var n=r(47568),l=r(10253),i=r(34051),a=r.n(i),o=r(90317),s="Something went wrong publishing your Template";function c(e){if(e.error)return e.error.message||s;if(e.data){if("createReplDeployment"in e.data){if("NotFoundError"===e.data.createReplDeployment.__typename||"UnauthorizedError"===e.data.createReplDeployment.__typename||"UserError"===e.data.createReplDeployment.__typename)return e.data.createReplDeployment.message;if("Repl"!==e.data.createReplDeployment.__typename)return s}if("createReplRelease"in e.data){if("NotFoundError"===e.data.createReplRelease.__typename||"UnauthorizedError"===e.data.createReplRelease.__typename||"UserError"===e.data.createReplRelease.__typename)return e.data.createReplRelease.message;if("Repl"!==e.data.createReplRelease.__typename)return s}}}function u(){var e=(0,l.Z)((0,o.MM_)(),2),t=e[0],r=e[1],i=(0,l.Z)((0,o.pec)(),2),u=i[0],d=i[1],p=function(){var e=(0,n.Z)(a().mark((function e(t){var n,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.input,!r.loading&&!d.loading){e.next=3;break}return e.abrupt("return",{data:null,error:null});case 3:return e.prev=3,e.next=6,u({refetchQueries:["ReplEnvironmentHeader"],variables:{input:n}});case 6:return l=e.sent,e.abrupt("return",{data:l.data,error:c(l)});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{data:null,error:s});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=(0,n.Z)(a().mark((function e(n){var l,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=n.input,!r.loading&&!d.loading){e.next=3;break}return e.abrupt("return",{data:null,error:null});case 3:return e.prev=3,e.next=6,t({variables:{input:l}});case 6:return i=e.sent,e.abrupt("return",{data:i.data,error:c(i)});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{data:null,error:s});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}();return{createRelease:p,createDeployment:h,data:r.data||d.data,loading:r.loading||d.loading,error:c(r||d)}}}}]);
//# sourceMappingURL=4593-601a619eb9eb0899.js.map