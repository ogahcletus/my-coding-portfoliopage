(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9601],{50217:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});var r=t(47568),o=t(26042),a=t(69396),c=t(99534),i=t(34051),u=t.n(i),s=t(54098),l=t.n(s),d=t(16260),p=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;function f(e){return v.apply(this,arguments)}function v(){return(v=(0,r.Z)(u().mark((function e(n){var t,r,i,s,f,v,g,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.url,r=(0,c.Z)(n,["url"]),e.prev=2,e.next=5,l()(t,{credentials:"same-origin",headers:{"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest"},method:"post",body:JSON.stringify((0,a.Z)((0,o.Z)({},r),{format:"pbuf"}))});case 5:i=e.sent,e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(2),e.t0.statusCode=504,e.t0;case 12:if(i.ok){e.next=28;break}if(!(f=i.headers.get("content-type"))||!f.includes("application/json")){e.next=22;break}return e.next=18,i.json();case 18:v=e.sent,s=v.message,e.next=25;break;case 22:return e.next=24,i.text();case 24:s=e.sent;case 25:throw(g=new Error(s||i.statusText)).statusCode=i.status,g;case 28:return e.next=30,i.json();case 30:if((h=e.sent).token.startsWith("v2.public.")||p.test(h.token)){e.next=33;break}throw new d.Z("Expected token to be PASETO- or base64-encoded").setExtras((0,o.Z)({connectionMetadata:h,url:t},r));case 33:return e.abrupt("return",h);case 34:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}},89596:function(e,n,t){"use strict";t.d(n,{d:function(){return u},h:function(){return i}});var r=t(50055),o=t(34155),a=t(48764).Buffer,c=o.env.PROXY_SUFFIX||"repl.co";function i(e){var n=e.split(".");if(4!==n.length)throw new Error("Invalid token: should have exactly 4 parts: "+e);for(var t=n[2].replace(/-/g,"+").replace(/_/g,"/");t.length%4;)t+="=";var o=window.atob(t);if(o.length<64)throw new Error("Invalid token: signed part is too short: "+o.length);var c=o.substring(0,o.length-64);try{return r.api.ReplToken.decode(new a(c,"base64"))}catch(i){return JSON.parse(window.atob(c))}}function u(e){var n=i(e).repl,t=n.user,r=n.slug,o=n.id,a="".concat(r,"--").concat(t);return a.length>63&&(a="".concat(o,".id")),-1!==c.indexOf("repl.localhost:8080")?"ws://".concat(a,".").concat(c):"wss://".concat(a,".").concat(c)}},76416:function(e,n,t){"use strict";t.d(n,{u:function(){return c}});var r=t(47568),o=t(34051),a=t.n(o);function c(){return i.apply(this,arguments)}function i(){return(i=(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}return e.abrupt("return");case 2:if(document.hidden){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",new Promise((function(e){var n=function(){document.hidden||(document.removeEventListener("visibilitychange",n),e())};document.addEventListener("visibilitychange",n)})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},5783:function(e,n,t){"use strict";t.d(n,{e:function(){return k.e},Z:function(){return A}});var r=t(47568),o=t(26042),a=t(69396),c=t(99534),i=t(34051),u=t.n(i),s=t(68944),l=t(92876);function d(e){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)(u().mark((function e(n){var t,r,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.client,r=n.args,o=n.env,e.abrupt("return",new Promise((function(e){var n=t.openChannel({service:"exec"},(function(t){var a=t.error,c=t.channel;if(a)e({error:a.message,output:null});else{if(!c)throw new Error("Expected channel");var i="";c.onCommand((function(e){e.output&&(i+=e.output)})),c.request({exec:{args:r,env:o}}).then((function(t){t.channelClosed?e({error:"Channel closed",output:i||null}):("open"===c.status&&n(),t.error?e({error:t.error,output:i||null}):e({output:i,error:null}))}))}}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var f=t(58809),v=t(55768),g=t(50217),h=t(11163),w=t.n(h),E=t(7787),C=t(34155),m=Boolean(C.env.CAPTCHA_EMBEDS);function b(e){return x.apply(this,arguments)}function x(){return(x=(0,r.Z)(u().mark((function e(n){var t,r,c,i,s,l,d,p,h;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.replId,r=n.isLoggedIn,c=n.overrideClusterMetadata,i=n.retry,s=n.asViewer,f.l){e.next=3;break}throw new Error("Expected apollo client");case 3:if(l=function(e){E.kg.error("Goval connection failure",{errorMessage:e&&e.message||"unidentified failure",replId:t,reason:"captcha",context:"services"})},d=Boolean(w().query.lite||w().query.embed),p={url:"/data/repls/".concat(t,"/get_connection_metadata"),overrideClusterMetadata:c,clientVersion:"0b32a21",hCaptchaSiteKey:v.w,isEmbed:d,flags:{},retry:i||0,asViewer:s},r||d&&!m){e.next=18;break}return e.prev=7,e.next=10,(0,v.Z)();case 10:return h=e.sent,e.abrupt("return",(0,g.Z)((0,a.Z)((0,o.Z)({},p),{captcha:h})));case 14:return e.prev=14,e.t0=e.catch(7),l(e.t0),e.abrupt("return",b({replId:t,overrideClusterMetadata:c,retry:(i||0)+1,isLoggedIn:r}));case 18:return e.abrupt("return",(0,g.Z)(p));case 19:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}var N,k=t(18962),y=t(5133),T=t(89596),O=t(76416),Z=t(16260),S=t(59077),I=t(86292),_=t(99336),M=t(25108);function A(e){var n=e.onUnrecoverableError,t=(0,y.ZP)();t.setMaxListeners(1e3);var i=null,p=k.e.DISCONNECTED,f=function(e){p!==e&&(p=e,t.emit(N.CONNECTION_STATE_CHANGE,p))},v=function(){var e,n=function(){e&&(e(),e=void 0)};return{register:function(t,r){n();var o=t,a=r;return window.addEventListener("online",o),window.addEventListener("offline",a),e=function(){window.removeEventListener("online",o),window.removeEventListener("offline",a)},n},unregister:n}}(),g=v.register,h=v.unregister,w=new s.KU;w.onDebugLog((function(e){if("breadcrumb"===e.type){var n;n="containerState"===e.message?{containerState:e.data}:"data"in e?e.data:void 0,_.c_.addBreadcrumb({category:"crosisV6",message:e.message,data:n}),l.n_({category:"crosisV6",message:e.message,data:n});var t={replId:null===i||void 0===i?void 0:i.repl.id,language:null===i||void 0===i?void 0:i.repl.language},r="crosis ".concat(e.message);switch(e.message){case"connect timeout":E.kg.error(r,t);break;case"retrying":var a=e.data,u=a.error,s=(0,c.Z)(a,["error"]),d=(0,o.Z)({errorMessage:u.message},t,s);E.kg.error(r,d);break;case"unrecoverable error":var p=(0,o.Z)({errorMessage:e.data.message},t);E.kg.error(r,p);break;case"connecting":case"reconnecting":case"polling fallback":E.kg.info(r,(0,o.Z)({},t,"data"in e?e.data:void 0))}}}));var C=window.location.search.includes("debug=1");return C&&w.onDebugLog((function(e){"log"===e.type&&M.log("in"===e.log.direction?"--\x3e":"<--",e.log.cmd)})),{onPortOpened:function(e){return t.on(N.PORT_OPEN,e),function(){t.removeListener(N.PORT_OPEN,e)}},onToast:function(e){return t.on(N.TOAST,e),function(){t.removeListener(N.TOAST,e)}},onConnectionStateChanged:function(e){return t.on(N.CONNECTION_STATE_CHANGE,e),function(){t.removeListener(N.CONNECTION_STATE_CHANGE,e)}},connect:function(e){var l=this,d=e.context,v=e.customConnectionMetadata,h=e.fetchConnectionMetadataExtras,m=(0,c.Z)(e,["context","customConnectionMetadata","fetchConnectionMetadataExtras"]);i=d,p!==k.e.DISCONNECTED&&w.close();var x=null;g((function(){l.connect((0,o.Z)({context:d,customConnectionMetadata:v,fetchConnectionMetadataExtras:h},m))}),(function(){l.close()}));var y=this,T=function(){var e=(0,r.Z)(u().mark((function e(n){var t,r,a,c,i,s,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.chan0,r=n.gurl,a=n.shouldLogPeriodically,c=n.shouldReconnectNoResponse,i=n.isFirst,"open"===t.status){e.next=3;break}return e.abrupt("return");case 3:return s=E.kg.timeStart({gurl:r}),l=setTimeout((function(){E.kg.error("ping with no response",{gurl:r,shouldReconnectNoResponse:c}),c&&y.connect((0,o.Z)({context:d,customConnectionMetadata:v,fetchConnectionMetadataExtras:h},m))}),3e4),e.next=7,t.request({ping:{}});case 7:if(p=e.sent.channelClosed,clearTimeout(l),!p){e.next=11;break}return e.abrupt("return");case 11:i?s("latency to pid1",{type:"startup"}):a&&s("latency to pid1",{type:"periodic"}),setTimeout((function(){return T({chan0:t,gurl:r,shouldLogPeriodically:a,shouldReconnectNoResponse:c,isFirst:!1})}),1e3);case 13:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_={context:d,reuseConnectionMetadata:!0,fetchConnectionMetadata:function(){var e=(0,r.Z)(u().mark((function e(n){var t,r,c,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.performance.clearMarks(E.Iy.fetchConnectionMetadataPageInvisibleStart),window.performance.clearMarks(E.Iy.fetchConnectionMetadataPageInvisibleEnd),t=E.kg.timeStart(),window.performance.mark(E.Iy.fetchConnectionMetadataPageInvisibleStart),e.next=7,(0,O.u)();case 7:window.performance.mark(E.Iy.fetchConnectionMetadataPageInvisibleEnd),t("page visible fetch connection metadata");case 9:return e.next=11,(0,S.Z)();case 11:if(r=e.sent,!n.aborted){e.next=14;break}return e.abrupt("return",{error:s.gS.Aborted});case 14:if(r||!v||x===v.token){e.next=17;break}return x=v.token,e.abrupt("return",(0,a.Z)((0,o.Z)({},v),{error:null}));case 17:if(c=E.kg.timeStart({hasCustomFetch:Boolean(m.fetchConnectionMetadata)}),e.prev=19,!m.fetchConnectionMetadata){e.next=26;break}return e.next=23,m.fetchConnectionMetadata();case 23:i=e.sent,e.next=29;break;case 26:return e.next=28,b((0,o.Z)({asViewer:d.asViewer,replId:d.repl.id,isLoggedIn:Boolean(d.currentUser),overrideClusterMetadata:r},h));case 28:i=e.sent;case 29:e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(19),!n.aborted){e.next=35;break}return e.abrupt("return",{error:s.gS.Aborted});case 35:e.t1=e.t0&&e.t0.statusCode,e.next=400===e.t1||408===e.t1||409===e.t1||429===e.t1||500===e.t1||502===e.t1||503===e.t1||504===e.t1?38:39;break;case 38:return e.abrupt("return",{error:s.gS.Retriable});case 39:throw e.t0;case 40:if(!n.aborted){e.next=42;break}return e.abrupt("return",{error:s.gS.Aborted});case 42:return C&&M.log("connecting",i),c("fetched connection metadata"),e.abrupt("return",(0,a.Z)((0,o.Z)({},i),{error:null}));case 45:case"end":return e.stop()}}),e,null,[[19,31]])})));return function(n){return e.apply(this,arguments)}}(),pollingHost:"gp-v2.replit.com"};"firewalledreplit.com"===(null===window||void 0===window?void 0:window.location.hostname)&&(_.pollingHost="gp-v2.firewalledreplit.com");var A=window.performance.now(),L=0;w.open(_,(function(e){var r,o,a,c=e.channel;if(e.error)return f(k.e.DISCONNECTED),function(){};if(!c)throw new Error("Expected channel");C&&M.log("connected",{replId:d.repl.id});var u=c.onCommand((function(e){switch(e.body){case"portOpen":if(!e.portOpen)throw new Error("portOpen only handles portOpen commands");if(!e.portOpen.forwarded)return;var r=e.portOpen.port||0;if(5901===r)return;(0,I.j)(I.U3.PORT_OPENED,{port:r,isVnc:5900===r}),t.emit(N.PORT_OPEN,{port:r,isVnc:5900===r});break;case"protocolError":var o,a;n(new Z.Z("goval panic").setExtra("message",null!==(a=null===(o=e.protocolError)||void 0===o?void 0:o.text)&&void 0!==a?a:"protocol error"));break;case"toast":var c,i=null===(c=e.toast)||void 0===c?void 0:c.text;if(!i)break;t.emit(N.TOAST,i)}}));T({chan0:c,gurl:null===(r=w.getConnectionMetadata())||void 0===r?void 0:r.gurl,shouldLogPeriodically:null===(o=d.currentUser)||void 0===o?void 0:o.flagPid1Ping,shouldReconnectNoResponse:null===(a=d.currentUser)||void 0===a?void 0:a.flagNoPongReconnect,isFirst:!0}),window.v6ws=w.ws;var s=d.repl,l=s.id,p=s.language,v=window.performance.now()-A;return E.kg.info("connected to pid1",{time:v,reconnectCount:L,replId:l,language:p}),f(k.e.CONNECTED),function(e){var n=e.willReconnect;if(u(),!n)return i=null,void f(k.e.DISCONNECTED);A=window.performance.now(),L++,f(k.e.CONNECTING)}})),f(k.e.CONNECTING)},openChannel:function(e,t){return w.openChannel(e,(function(e){var r,o=null===e||void 0===e||null===(r=e.channel)||void 0===r?void 0:r.onCommand((function(e){var t,r;"protocolError"===e.body&&n(new Z.Z("goval panic").setExtra("message",null!==(r=null===(t=e.protocolError)||void 0===t?void 0:t.text)&&void 0!==r?r:"protocol error"))})),a=t(e);return function(e){a&&a(e),o&&o()}}))},getConnectionState:function(){return p},exec:(0,r.Z)(u().mark((function e(){var n,t,r,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=o.length,t=new Array(n),r=0;r<n;r++)t[r]=o[r];return e.abrupt("return",d({client:w,args:t}));case 2:case"end":return e.stop()}}),e)}))),execWithEnv:function(){var e=(0,r.Z)(u().mark((function e(n){var t,r,o,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=a[o];return e.abrupt("return",d({client:w,args:r,env:n}));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),close:function(){p!==k.e.DISCONNECTED&&w.close()},destroy:function(){w.destroy(),t.removeAllListeners(),h()},client:function(){return w},getConnectionMetadata:function(){return w.getConnectionMetadata()},getContext:function(){return i},getVncUrl:function(){var e=w.getConnectionMetadata();if(!e||p!==k.e.CONNECTED)throw new Error("Cannot get vnc url when container is not connected");return(0,T.d)(e.token)},unrecoverableError:function(e,r){w.destroy(),t.removeAllListeners(),n(r?Z.Z.wrap(e).setExtras(r):e)}}}!function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.PORT_OPEN="PORT_OPEN",e.TOAST="TOAST"}(N||(N={}))},18962:function(e,n,t){"use strict";var r;t.d(n,{e:function(){return r}}),function(e){e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.DISCONNECTED="DISCONNECTED"}(r||(r={}))},86127:function(e,n,t){"use strict";t.d(n,{S:function(){return o},w:function(){return r}});function r(){return window.__ENABLE_ALL_SERVICES}function o(){window.__ENABLE_ALL_SERVICES=!0}},59077:function(e,n,t){"use strict";t.d(n,{Z:function(){return d},t:function(){return l}});var r=t(47568),o=t(34051),a=t.n(o),c=t(35642),i=(t(54098),t(25108));function u(){return s.apply(this,arguments)}function s(){return(s=(0,r.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.Z.get("gurl")){e.next=3;break}return i.log("Getting gurl from localstorage"),e.abrupt("return",c.Z.get("gurl"));case 3:e.next=5;break;case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){var n=function(e){var n;try{n=new URL(e)}catch(r){return i.log("failed to parse gurl"),i.error(r),null}var t={secure:!1,port:""+n.port,host:n.hostname};return"wss:"===n.protocol?t.secure=!0:"ws:"!==n.protocol&&i.log(e,"Expected gurl protocol to be ws or wss, assuming insecure connection"),t.port||(t.port=t.secure?"443":"80"),t}(e);if(!n)return null;var t=n.secure,r=n.host,o=n.port;return"eval.repl.it"===r||"gp-v2.replit.com"===r||"gp-v2.firewalledreplit.com"===r||"eval.replit.com"===r?null:{id:"development",gurl:"ws".concat(t?"s":"","://").concat(r,":").concat(o),conmanURL:"http".concat(t?"s":"","://").concat(r,":").concat(o),proxy:"http".concat(t?"s":"","://").concat(r.replace("eval","proxy"),":").concat(o)}}function d(){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u();case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",l(n));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},77020:function(){}}]);
//# sourceMappingURL=9601-e595020e26262f77.js.map